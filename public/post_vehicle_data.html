<!DOCTYPE html>
<html>
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

      <!-- vehicle api 必須 : ここから-->
      <script src="http://52.193.125.145:3000/socket.io/socket.io.js"></script> 
      <script src="http://52.193.125.145:3000/www/js/vehicleAPI.js"></script>
      <script src="http://52.193.125.145:3000/www/js/vehicleAPI-client.js"></script>
      <script>
        var roomID = "cherassco";

        window.onload = function () {
          document.getElementById("WSRoomID").innerHTML = roomID;
          var msg = {"roomID":roomID, "data":"NOT REQUIRED"};
          socket.emit('joinRoom', JSON.stringify(msg));        
        }
      </script>
      <!-- vehicle api 必須 : ここまで -->

      <script>
        var vehicle_data = {
          vehicle_speed: false,
          engine_speed: false,
          acceleration_x: false,
          acceleration_y: false,
          acceleration_z: false,
          gyro_x: false,
          gyro_y: false,
          gyro_z: false,
          steering_wheel: false,
          latitude: false,
          longitude: false,
          altitude: false,
          gps_heading: false,
          gps_speed: false
        };

        var vehicle_datas = [];

        var vehicle_data_completed = false;

        var vehicle_speed_sub = navigator.vehicle.vehicleSpeed.subscribe( function( vehicle_speed ){
          vehicle_data.vehicle_speed = vehicle_speed.speed;
        });

        var engine_speed_sub = navigator.vehicle.engineSpeed.subscribe( function( engine_speed ){
          vehicle_data.engine_speed = engine_speed.speed;
        });

        var acceleration_sub = navigator.vehicle.acceleration.subscribe( function( acceleration ){
          vehicle_data.acceleration_x = acceleration.x;
          vehicle_data.acceleration_y = acceleration.y;
          vehicle_data.acceleration_z = acceleration.z;
        });

        var gyro_sub = navigator.vehicle.gyro.subscribe( function( gyro ){
          vehicle_data.gyro_x = gyro.pitchRate;
          vehicle_data.gyro_y = gyro.rollRate;
          vehicle_data.gyro_z = gyro.yawRate;
        });

        var steering_wheel_sub = navigator.vehicle.steeringWheel.subscribe( function( steering_wheel ){
          vehicle_data.steering_wheel = steering_wheel.angle;
        });

        var gps_sub = navigator.vehicle.location.subscribe( function( gps ){
          vehicle_data.latitude = gps.latitude;
          vehicle_data.longitude = gps.longitude;
          vehicle_data.altitude = gps.altitude;
          vehicle_data.gps_heading = gps.heading;
          vehicle_data.gps_speed = gps.speed;
        });

        setInterval( "storeData()", 500 );

        function storeData(){
          if( !vehicle_data_completed ){
            vehicle_data_completed = true;
            for( key in vehicle_datas ){
              vehicle_data_completed = vehicle_data_completed && vehicle_datas[ key ];
            }
            return;
          }

          vehicle_datas.push(vehicle_data);
          if( vehicle_datas.length == 10 ){
            // TODO: post
            console.log(vehicle_datas);
            vehicle_datas = [];
          }
        }

      </script>
    </head>
    <body>
      <div>
        Room ID:<span id="WSRoomID"> </span>
      </div>
      <div>
        VehicleSpeed:<span id="VehicleSpeed"> </span> [km/h]
      </div>
    </body>
</html>
